class HaxeBuilder {
 List<String> vals = [];
 
 public HaxeBuilder (String exec) {
  vals += [exec]
 }
 
 public HaxeBuilder cp (String s) {
  vals += ["-cp", s]
  this
 }
 
 public HaxeBuilder cp (List<String> cps) {
  cps.each {
    cp -> vals += ["-cp", "\"$cp\""]
  }
  this
 }
 
 public HaxeBuilder macro (String macroCall) {
  vals += ["--macro", "\"$macroCall\""]
  this
 }
 
 public HaxeBuilder hxml (String hxml) {
  vals += [hxml]
  this
 }
 
 public HaxeBuilder neko (String nekoFile) {
  vals += ["-neko", "\"$nekoFile\""]
  this
 }
 
 public HaxeBuilder cpp (String cppDir) {
  vals += ["-cpp", "\"$cppDir\""]
  this
 }
 
 public HaxeBuilder php (String phpDir) {
  vals += ["-php", "\"$phpDir\""]
  this
 }
 
 public HaxeBuilder lib (String lib) {
  vals += ["-lib", lib]
  this
 }
 
 public HaxeBuilder debug () {
  vals += ["-debug"]
  this
 }
 
 public HaxeBuilder js (String jsFile) {
  vals += ["-js", "\"$jsFile\""]
  this
 }
 
 public HaxeBuilder flash (String flash, String version) {
  vals += ["-flash", "\"$flash\""]
  vals += ["-flash-version", version]
  this
 }
 
 public HaxeBuilder main (String s) {
  vals += ["-main", s]
  this
 }
 
 public HaxeBuilder connect (String address) {
  vals += ["--connect", address]
  this
 }
 
 public HaxeBuilder noOutput () {
  vals += ["--no-output"]
  this
 }
 
 public HaxeBuilder define (String val) {
  vals += ["-D", val]
  this
 }
 
 public HaxeBuilder next () {
  vals += ["--next"]
  this
 }
 
 public List<String> values () {
  vals
 }
}

public void writeToFile(def directory, def fileName, def extension, def infoList) {
  File file = new File("$directory/$fileName$extension")

  infoList.each {
    file << ("${it}\n")
  }
  
}

public List<String> haxeCompilation(def exe, def classpaths, def additionals) 
{
  def cps = []
  classpaths.each {
    cp -> cps = cps + ['-cp', cp]
  }
  
  def add = []
  additionals.each {
    key, value -> 
      add = add + [key]
      if (value != null) add = add + [value]
    
  }
  
  def res = [exe] + cps + add
  
  
  res
  
  
}

project.ext.haxeBuilder = {
  exec -> new HaxeBuilder(exec)
}

project.ext.haxeCompilation = this.&haxeCompilation
project.ext.writeToFile = this.&writeToFile
